<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Cloud Climber Bunny</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    #game-container {
      width: 100%;
      height: 100vh;
    }
    .mobile-controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 99;
      display: flex;
      gap: 20px;
    }
    .mobile-btn {
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.5);
      border-radius: 50%;
      font-size: 30px;
      text-align: center;
      line-height: 60px;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="game-container"></div>
  <div class="mobile-controls">
    <div class="mobile-btn" id="left">⭠</div>
    <div class="mobile-btn" id="right">⭢</div>
    <div class="mobile-btn" id="jump">⭡</div>
  </div>

  <script>
    const config = {
      type: Phaser.AUTO,
      width: window.innerWidth,
      height: window.innerHeight,
      parent: 'game-container',
      physics: {
        default: 'arcade',
        arcade: {
          gravity: { y: 600 },
          debug: false
        }
      },
      scene: {
        preload,
        create,
        update
      }
    };

    let player, cursors, platforms, movingPlatforms, disappearingClouds, crates, camera;
    let leftPressed = false, rightPressed = false, jumpPressed = false;

    const game = new Phaser.Game(config);

    function preload() {
      this.load.image('sky', 'https://labs.phaser.io/assets/skies/sky4.png');
      this.load.image('cloud', 'https://labs.phaser.io/assets/sprites/platform.png');
      this.load.image('crate', 'https://labs.phaser.io/assets/sprites/crate.png');
      this.load.image('bunny', 'https://labs.phaser.io/assets/sprites/rabbit.png');
    }

    function create() {
      this.add.image(400, 300, 'sky').setScale(2);
      platforms = this.physics.add.staticGroup();
      disappearingClouds = this.physics.add.group();
      movingPlatforms = this.physics.add.group();
      crates = this.physics.add.group({ allowGravity: true, immovable: false });

      // Create base ground
      platforms.create(400, 590, 'cloud').setScale(2).refreshBody();

      // Static clouds
      platforms.create(300, 500, 'cloud');
      platforms.create(600, 420, 'cloud');
      platforms.create(100, 340, 'cloud');
      platforms.create(400, 260, 'cloud');

      // Disappearing clouds
      disappearingClouds.create(200, 180, 'cloud');
      disappearingClouds.create(500, 100, 'cloud');

      // Moving cloud
      const moving = movingPlatforms.create(400, 200, 'cloud');
      moving.body.velocity.x = 50;
      moving.setImmovable(true);

      // Crate to move
      const crate = crates.create(300, 460, 'crate');
      crate.setCollideWorldBounds(true);

      player = this.physics.add.sprite(100, 520, 'bunny');
      player.setBounce(0.1);
      player.setCollideWorldBounds(true);

      this.physics.add.collider(player, platforms);
      this.physics.add.collider(player, movingPlatforms);
      this.physics.add.collider(player, disappearingClouds, disappearCloud, null, this);
      this.physics.add.collider(player, crates);

      this.physics.add.collider(crates, platforms);
      this.physics.add.collider(crates, movingPlatforms);

      // Mobile controls
      document.getElementById('left').addEventListener('touchstart', () => leftPressed = true);
      document.getElementById('left').addEventListener('touchend', () => leftPressed = false);
      document.getElementById('right').addEventListener('touchstart', () => rightPressed = true);
      document.getElementById('right').addEventListener('touchend', () => rightPressed = false);
      document.getElementById('jump').addEventListener('touchstart', () => jumpPressed = true);
      document.getElementById('jump').addEventListener('touchend', () => jumpPressed = false);

      cursors = this.input.keyboard.createCursorKeys();

      // Camera follows player
      this.cameras.main.startFollow(player);
      this.cameras.main.setBounds(0, 0, 800, 1200);
    }

    function update() {
      if (movingPlatforms.children.entries.length) {
        movingPlatforms.children.iterate(function (platform) {
          if (platform.x > 500) platform.body.velocity.x = -50;
          else if (platform.x < 300) platform.body.velocity.x = 50;
        });
      }

      player.setVelocityX(0);
      if (cursors.left.isDown || leftPressed) {
        player.setVelocityX(-160);
      } else if (cursors.right.isDown || rightPressed) {
        player.setVelocityX(160);
      }

      if ((cursors.up.isDown || jumpPressed) && player.body.touching.down) {
        player.setVelocityY(-400);
      }
    }

    function disappearCloud(player, cloud) {
      cloud.disableBody(true, true);
    }
  </script>
</body>
</html>

